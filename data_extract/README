# Extract world data from UQM
The world data in Ur-Quan Masters (UQM) is not stored within the source code 
but is rather generated by a function using pseudo-random numbers. The data is 
normally only generated when needed. However UQM does have a debugging mode 
that dumps all world data. The UQM source code has been modified (`uqm` folder)
to dump additional data to `stdout`. 

To get access to the data UQM needs to build from source, in debug mode. 
The game requires a GCC version 4.9 to compile the game and will not compile 
with later versions. 

Docker is used to create the specific environment required to compile UQM. The
steps below describe how to compile and extract world data.

## Prerequisites
 * Linux - Ubuntu 18 recommended
 * Docker installed

## Building the docker container
From the command line navigate to the `data_extract` directory.
Then run the following to build the Docker image:
```shell script
docker build -t uqm_debug:latest .
```

## Building the UQM source code
Running a `uqm_debug` container will automatically compile the UQM game. 
Run the following to compile UQM within a docker container:
```shell script
docker run --name=uqm_instance uqm_debug 
``` 

The container will exit but not be destroyed. Next copy the compiled UQM source
code out of the container then destroy the container:
```
docker cp uqm_instance:/usr/uqm compiled &&
docker rm uqm_instance
```

## Running the game to extract data
The following will navigate to the compiled game, load in custom config settings
and start the game:
```
cd compiled/uqm &&
./uqm-debug --configdir=../../config | grep minz_s > sub_minerals.txt

```

To capture the game data, start a new game, press `F4` then navigate the star-ship out of the star system. This will cause the debugger
to export the game data, some to stdout, some to file. The stdout data is saved to`sub_minerals.txt` 

## Copying data to generate_maps folder 
Run the following to move the world data to the map generation sub project:
```
cp sub_minerals.txt ../../../generate_maps &&
cp PlanetInfo ../../../generate_maps
```
